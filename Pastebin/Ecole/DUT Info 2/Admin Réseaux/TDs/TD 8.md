# TD 8 (Pas vérifier)  
  
1. `apt install iptables-persistent`  
Yes & Yes  
`systemctl restart iptables`  
​  
`apt install netfilter-persistent`  
Normalement déjà installer  
2.  `iptables -L`  
![](https://cdn.discordapp.com/attachments/953586838940053584/953589661564022794/unknown.png)  
5. `systemctl restart iptables`  
`iptables -L`  
![](https://cdn.discordapp.com/attachments/953586838940053584/953591394876940298/unknown.png)  
4. `nano /etc/iptables/rules.v4`  
```bash
# Generated by iptables-save v1.8.4 on Wed Mar 16 09:42>
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 >-A INPUT -p udp -m udp --sport 67:68 --dport 67:68 -j A>-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
# Completed on Wed Mar 16 09:42:09 2022
```  
http://10.1.138.16/ ne doit plus être accessible.  
6. `nano /etc/iptables/rules.v4`  
```bash
# Generated by iptables-save v1.8.4 on Wed Mar 16 09:42>
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT

-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT

-A INPUT -p udp -m udp --sport 67:68 --dport 67:68 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
# Completed on Wed Mar 16 09:42:09 2022
```  
7. `systemctl restart iptables`  
http://10.1.138.16/ doit être accessible.  
8. 9.​ 10.​  
`nano /etc/iptables/rules.v4`  
```bash
# Generated by iptables-save v1.8.4 on Wed Mar 16 09:42:09 2022
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT

-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT

-A INPUT -p udp -m udp --sport 53 -j ACCEPT
-A INPUT -p udp -m udp --dport 53 -j ACCEPT
-A INPUT -p tcp -m state --state NEW --dport 25 -s 10.0.0.0/8 -j ACCEPT
-A INPUT -p tcp -m state --state NEW --dport 110 -s 10.0.0.0/8 -j ACCEPT
-A INPUT -p tcp -m state --state NEW --dport 143 -s 10.0.0.0/8 -j ACCEPT
-A INPUT -p tcp -m state --state NEW --dport 995 -s 10.0.0.0/8 -j ACCEPT
-A INPUT -p tcp -m state --state NEW --dport 993 -s 10.0.0.0/8 -j ACCEPT
-A INPUT -p tcp -m state --state NEW --dport 389 -s 10.1.136.0/22 -j ACCEPT

-A INPUT -p udp -m udp --sport 67:68 --dport 67:68 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
# Completed on Wed Mar 16 09:42:09 2022
```  
`systemctl restart iptables`  
http://dutXXX.iut-amiens.fr/ doit être accessible.  
